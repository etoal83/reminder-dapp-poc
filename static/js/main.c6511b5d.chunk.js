(this["webpackJsonpreminder-dapp-poc"]=this["webpackJsonpreminder-dapp-poc"]||[]).push([[0],{1106:function(e,t){},1321:function(e,t){},1334:function(e,t){},1384:function(e,t){},1470:function(e,t,n){"use strict";n.r(t);var r=n(14),c=n.n(r),i=n(567),o=n.n(i),a=(n(574),n(305)),s=n(0),u=n.n(s),l=n(42),d=n(55),f=n(193),j=n(41),b=n(1473),h=(n(576),n(568)),p=n.n(h),g=n(21),O=n(896),v=c.a.createContext(null),m=c.a.createContext(null),x=function(e){var t=e.children,n=Object(r.useState)(null),c=Object(d.a)(n,2),i=c[0],o=c[1],a=Object(r.useState)(null),s=Object(d.a)(a,2),f=s[0],j=s[1],b=function(){var e=Object(l.a)(u.a.mark((function e(){var t,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.create({EXPERIMENTAL:{pubsub:!0}});case 2:return t=e.sent,o(t),console.log("IPFS ready"),e.next=7,p.a.createInstance(t);case 7:n=e.sent,j(n),console.log("OrbitDB ready");case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(r.useEffect)((function(){b()}),[]),Object(g.jsx)(v.Provider,{value:i,children:Object(g.jsx)(m.Provider,{value:f,children:t})})},w=c.a.createContext({permission:"default",supported:!0}),D=function(e){var t=e.children,n=Object(r.useState)("Notification"in window),c=Object(d.a)(n,2),i=c[0],o=(c[1],Object(r.useState)(Notification.permission)),a=Object(d.a)(o,2),s=a[0],u=a[1];return Object(r.useEffect)((function(){i?function(){try{Notification.requestPermission().then()}catch(e){return!1}return!0}()&&Notification.requestPermission().then((function(e){!function(e){u(e)}(e)})):console.log("This browser does NOT support notifications.")}),[]),Object(g.jsx)(w.Provider,{value:{permission:s,supported:i},children:t})},k=function(){var e=Object(r.useState)(new Date),t=Object(d.a)(e,2),n=t[0],c=t[1];Object(r.useEffect)((function(){var e=window.setTimeout((function(){return c(new Date)}),1e3);return function(){clearTimeout(e)}}),[n]);var i=function(e){return("0"+e).slice(-2)};return Object(g.jsxs)("div",{className:"master-clock",style:{textAlign:"center",margin:"1em 0 2em"},children:[n.getFullYear()," / ",i(n.getMonth()+1)," /"," ",i(n.getDate())," (",["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][n.getDay()],")"," ",i(n.getHours()),":",i(n.getMinutes()),":",i(n.getSeconds())]})},y=function(){var e=Object(r.useContext)(v),t=Object(r.useContext)(m);return Object(g.jsxs)("div",{className:"system-info",children:[Object(g.jsx)("h2",{children:"IPFS and OrbitDB Status"}),Object(g.jsx)("p",{children:null===e?"IPFS not connected":"IPFS Connected"}),Object(g.jsx)("p",{children:null===t?"OrbitDB not instantiated":"OrbitDB CID: ".concat(null===t||void 0===t?void 0:t.id)}),Object(g.jsx)(f.b,{to:"/",children:"Back to app"})]})},S=function(){var e=Object(r.useContext)(m),t=Object(r.useContext)(w).permission,n=Object(r.useState)(null),c=Object(d.a)(n,2),i=c[0],o=c[1],s=Object(r.useState)({}),j=Object(d.a)(s,2),h=j[0],p=j[1],O=Object(r.useState)({message:"",datetime:null}),v=Object(d.a)(O,2),x=v[0],D=v[1],k=Object(r.useState)(Date.now()),y=Object(d.a)(k,2),S=y[0],N=y[1],C=Object(r.useState)([]),T=Object(d.a)(C,2),E=T[0],P=T[1],F=Object(r.useState)(Date.now()),M=Object(d.a)(F,2),W=M[0],I=M[1],A=function(){var t=Object(l.a)(u.a.mark((function t(){var n;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null!==e){t.next=2;break}return t.abrupt("return");case 2:if(null===i){t.next=4;break}return t.abrupt("return");case 4:return t.next=6,e.kvstore("reminders");case 6:return n=t.sent,t.next=9,n.load();case 9:o(n),N(Date.now());case 11:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),B=function(){var e=Object(l.a)(u.a.mark((function e(t){var n,r,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==i){e.next=2;break}return e.abrupt("return");case 2:if("Enter"===t.key){e.next=4;break}return e.abrupt("return");case 4:if(t.preventDefault(),!(n=x.message.trim())){e.next=13;break}return r=Object(b.a)(),c=new Date,e.next=11,i.put(r,{message:n,datetime:c.setMinutes(c.getMinutes()+3)});case 11:D({message:"",datetime:null}),N(Date.now());case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),L=function(){var e=Object(l.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==i){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,i.del(t);case 4:N(Date.now());case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),R=function(e){return("0"+e).slice(-2)},H=Object.entries(h).map((function(e,t){var n=e[0],r=e[1].message,c=e[1].datetime<Date.now(),i=new Date(e[1].datetime),o=i.getHours(),a=i.getMinutes(),s=i.getSeconds();return Object(g.jsxs)("li",{style:{textDecoration:c?"line-through":"none"},children:[R(o),":",R(a),":",R(s)," /"," ",r," ",Object(g.jsx)("button",{onClick:function(){return L(n)},children:"Delete"})]},n)}));return Object(r.useEffect)((function(){A()}),[e]),Object(r.useEffect)((function(){!function(){if(null!==i){var e=i.all;p(e)}}()}),[S]),Object(r.useEffect)((function(){var e=window.setTimeout((function(){!function(){var e=[];Object.entries(h).map((function(t,n){var r=new Date(t[1].datetime),c=new Date,i=r.getFullYear()===c.getFullYear(),o=r.getMonth()===c.getMonth(),a=r.getDate()===c.getDate(),s=r.getDay()===c.getDay(),u=r.getHours()===c.getHours(),l=r.getMinutes()===c.getMinutes(),d=r.getSeconds()===c.getSeconds();return i&&o&&a&&s&&u&&l&&d&&e.push(t[0]),null})),e.length&&(console.log("keys: ".concat(e)),P((function(t){return t.concat(e)})))}(),I(Date.now())}),1e3);return function(){clearTimeout(e)}}),[W]),Object(r.useEffect)((function(){!function(){var e;if(null!==i&&E.length){var t=E[0],n=i.get(t);if("object"!==typeof(e=n)||null===e||"string"!==typeof e.message)return console.log("The reminder ".concat(t," does NOT exist so the notification is skipped.")),void P((function(e){return e.slice(1)}));var r=n.message;new Notification("dReminder",{body:r}),N(Date.now()),P((function(e){return e.slice(1)}))}}()}),[E]),Object(g.jsxs)("div",{children:[Object(g.jsx)("div",{style:{textAlign:"center"},children:Object(g.jsx)("input",{className:"new-reminder",value:x.message,placeholder:"Enter message",onChange:function(e){D(Object(a.a)(Object(a.a)({},x),{},{message:e.target.value}))},onKeyDown:B,style:{width:"80%",padding:"12px 24px",fontSize:"1.6em",border:"none",marginRight:"auto",marginLeft:"auto"}})}),Object(g.jsx)("ul",{children:H}),Object(g.jsx)("h2",{style:{marginTop:"2em"},children:"Dev info"}),Object(g.jsxs)("dl",{children:[Object(g.jsx)("dt",{children:"Datastore multihash"}),Object(g.jsxs)("dd",{children:[null===i||void 0===i?void 0:i.address.root," / ",null===i||void 0===i?void 0:i.address.path]}),Object(g.jsx)("dt",{children:"Notification permission"}),Object(g.jsxs)("dd",{children:[t," ",Object(g.jsx)("button",{onClick:function(){new Notification("dReminder",{body:"Notification test"})},children:"test"})," "]})]}),Object(g.jsx)(f.b,{to:"/about",children:"more"})]})};var N=function(){return Object(g.jsx)("div",{className:"App",children:Object(g.jsx)(D,{children:Object(g.jsx)(x,{children:Object(g.jsxs)(f.a,{children:[Object(g.jsx)("div",{className:"app-title",style:{width:"100%"},children:Object(g.jsx)("h1",{style:{color:"#61dafb",fontWeight:100,fontSize:"5.5rem",padding:"0.33em 0 0",margin:0,textAlign:"center"},children:"dReminder"})}),Object(g.jsx)(k,{}),Object(g.jsxs)(j.c,{children:[Object(g.jsx)(j.a,{exact:!0,path:"/",component:S}),Object(g.jsx)(j.a,{path:"/about",component:y}),Object(g.jsx)(j.a,{component:S})]})]})})})})},C=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function T(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var E=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,1474)).then((function(t){var n=t.getCLS,r=t.getFID,c=t.getFCP,i=t.getLCP,o=t.getTTFB;n(e),r(e),c(e),i(e),o(e)}))};o.a.render(Object(g.jsx)(c.a.StrictMode,{children:Object(g.jsx)(N,{})}),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/reminder-dapp-poc",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/reminder-dapp-poc","/service-worker.js");C?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var r=n.headers.get("content-type");404===n.status||null!=r&&-1===r.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):T(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")}))):T(t,e)}))}}(),E()},227:function(e,t){},247:function(e,t){},574:function(e,t,n){},576:function(e,t,n){},590:function(e,t){},670:function(e,t){},683:function(e,t){},685:function(e,t){},700:function(e,t){},740:function(e,t){},742:function(e,t){},781:function(e,t){},797:function(e,t){},844:function(e,t){},898:function(e,t){},903:function(e,t){}},[[1470,1,2]]]);
//# sourceMappingURL=main.c6511b5d.chunk.js.map